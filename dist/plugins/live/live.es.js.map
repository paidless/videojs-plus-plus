{"version":3,"file":"live.es.js","sources":["../../../source/Plugin/Live/LiveNotice.js","../../../source/Plugin/Live/Live.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\n/**\n * Displays the live indicator when duration is Infinity.\n * \n * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js\n *\n * @extends Component\n */\nclass LiveNotice extends ClickableComponent {\n\n  /**\n   * Creates an instance of this class.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L15-L33\n   *\n   * @param {Player} player\n   *        The `Player` that this class should be attached to.\n   *\n   * @param {Object} [options]\n   *        The key/value store of player options.\n   */\n  constructor(player, options) {\n    super(player, options);\n\n    this.updateLiveEdgeStatus();\n\n    if (this.player_.liveTracker) {\n      this.updateLiveEdgeStatusHandler_ = (e) => this.updateLiveEdgeStatus(e);\n      this.on(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n  }\n\n  /**\n   * Create the `Component`'s DOM element\n   *\n   * @return {Element}\n   *         The element that was created.\n   */\n  createEl() {\n    const el = videojs.dom.createEl('div', {\n      className: 'vjs-live-notice',\n      innerHTML: `\n        <div class=\"vjs-live-notice-spot vjs-icon-circle\"></div>\n        Live\n      `\n    });\n\n    return el;\n  }\n\n  /**\n   * Update the state of this button if we are at the live edge\n   * or not\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L57-L72\n   */\n  updateLiveEdgeStatus() {\n    // default to live edge\n    if (!this.player_.liveTracker || this.player_.liveTracker.atLiveEdge()) {\n      this.setAttribute('aria-disabled', true);\n      this.addClass('vjs-at-live-edge');\n    } else {\n      this.setAttribute('aria-disabled', false);\n      this.removeClass('vjs-at-live-edge');\n    }\n  }\n\n  /**\n   * On click bring us as near to the live point as possible.\n   * This requires that we wait for the next `live-seekable-change`\n   * event which will happen every segment length seconds.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L74-L81\n   */\n  handleClick() {\n    this.player_.liveTracker.seekToLiveEdge();\n  }\n\n  /**\n   * Dispose of the element and stop tracking\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L83-L94\n   */\n  dispose() {\n    if (this.player_.liveTracker) {\n      this.off(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n    this.textEl_ = null;\n\n    super.dispose();\n  }\n}\n\nvideojs.registerComponent('LiveNotice', LiveNotice);\n\nexport default LiveNotice;\n","import videojs from 'video.js';\nimport LiveNotice from './LiveNotice';\nimport './Live.scss';\n\nconst Plugin = videojs.getPlugin('plugin');\n\nconst defaults = {\n  dvr: true\n}\n\nclass Live extends Plugin {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.options = videojs.mergeOptions(defaults, options);\n\n    this.createLiveNotive(player);\n\n    this.start(player);\n  }\n\n  createLiveNotive(player) {\n    const { parent, index } = player.findChild('DurationDisplay')[0];\n    const noticeEl = new LiveNotice(player);\n\n    parent.addChild(noticeEl, {}, index);\n\n    this.on('dispose', () => {\n      parent.removeChild(noticeEl);\n    });\n  }\n\n  start(player) {\n    const onTimeupdate = this.onTimeUpdate.bind(this);\n\n    player.addClass('vjs-live-streaming');\n    if (this.options.dvr) {\n      player.addClass('vjs-live-dvr');\n    }\n    player.on('timeupdate', onTimeupdate);\n\n    this.on('dispose', () => {\n      player.off('timeupdate', onTimeupdate);\n      player.removeClass('vjs-live-streaming');\n      player.removeClass('vjs-live-dvr');\n      player.removeClass('vjs-live');\n    });\n  }\n\n  onTimeUpdate() {\n    const player = this.player;\n    const duration = player.duration();\n\n    if (duration === Infinity || player.currentTime() >= duration) {\n      player.addClass('vjs-live');\n    } else {\n      player.removeClass('vjs-live');\n    }\n  }\n}\n\nvideojs.registerPlugin('live', Live);\n"],"names":["ClickableComponent","videojs","getComponent","LiveNotice","player","options","updateLiveEdgeStatus","player_","liveTracker","updateLiveEdgeStatusHandler_","e","on","createEl","el","dom","className","innerHTML","atLiveEdge","setAttribute","addClass","removeClass","handleClick","seekToLiveEdge","dispose","off","textEl_","registerComponent","Plugin","getPlugin","defaults","dvr","Live","mergeOptions","createLiveNotive","start","findChild","parent","index","noticeEl","addChild","removeChild","onTimeupdate","onTimeUpdate","bind","duration","Infinity","currentTime","registerPlugin"],"mappings":"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"}