{"version":3,"file":"index.js","sources":["../../../source/Utils/List.js","../../../source/Plugin/Quality/QualitySettingItem.js","../../../source/Plugin/Quality/Quality.js"],"sourcesContent":["class List {\n  constructor(array, startIndex) {\n    this.values = array.slice(0);\n    this.index_ = startIndex || 0;\n    this.loop_ = true;\n  }\n\n  index(value) {\n    if (typeof value !== 'undefined') {\n      this.index_ = Math.max(0, Math.min(value, this.values.length - 1));\n    } else {\n      return this.index_;\n    }\n  }\n\n  loop(value) {\n    if (typeof value !== 'undefined') {\n      this.loop_ = !!value;\n    } else {\n      return this.loop_;\n    }\n  }\n\n  calc(steps) {\n    const newIndex = this.index_ + steps;\n    const length = this.values.length;\n\n    return this.loop_\n      ? (length + newIndex) % length\n      : Math.max(0, Math.min(newIndex, length - 1));\n  }\n\n  step(steps) {\n    this.index_ = this.calc(steps);\n\n    return this.values[this.index_];\n  }\n\n  current() {\n    return this.values[this.index_];\n  }\n\n  next() {\n    return this.step(1);\n  }\n\n  prev() {\n    return this.step(-1);\n  }\n\n  ended() {\n    return this.index_ === this.values.length - 1;\n  }\n}\n\nexport default List;\n","import videojs from 'video.js';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass QualitySettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'QualitySettingItem',\n      label: 'Quality',\n      icon: 'vjs-icon-hd',\n      entries: player.options_.quality || []\n    });\n\n    this.addClass('vjs-setting-quality');\n\n    player.on('quality', (_, qualities) => {\n      const entries = qualities.map((quality, index) => {\n        quality.value = index;\n        return quality;\n      });\n\n      this.setEntries(entries, player.qualities.index());\n\n      this.show();\n    });\n\n    player.on('qualitychange', (_, { index }) => {\n      this.select(index);\n      this.update(index);\n    });\n  }\n\n  onChange(...args) {\n    super.onChange(...args);\n    this.player_.qualities.pick(this.selected.value);\n  }\n}\n\nvideojs\n  .getComponent('SettingMenuButton')\n  .prototype.options_.entries.push('QualitySettingItem');\n\nvideojs.registerComponent('QualitySettingItem', QualitySettingItem);\n\nexport default QualitySettingItem;\n","import videojs from 'video.js';\nimport List from '../../Utils/List';\n\nimport './QualitySettingItem';\n\nclass Quality extends List {\n  constructor(player, array, defaultQualityLevel = 0) {\n    super(array, defaultQualityLevel);\n\n    this.player_ = player;\n\n    this.pick(defaultQualityLevel, true);\n  }\n\n  pick(index, skip) {\n    if (typeof index !== 'undefined') {\n      this.index(index);\n    }\n\n    const player = this.player_;\n    const current = this.current();\n    const cachedCurrentTime = player.ended() ? 0 : player.currentTime();\n\n    if (!skip && cachedCurrentTime) {\n      player.one('loadedmetadata', () => {\n        player.one('canplaythrough', () => {\n          player.currentTime(cachedCurrentTime);\n        });\n\n        player.play();\n      });\n    }\n\n    player.src(current.sources);\n\n    player.trigger('qualitychange', {\n      ...current,\n      index: this.index()\n    });\n  }\n}\n\nconst setQualities = function (qualities, defaultQualityLevel) {\n  const player = this.player_;\n\n  player.qualities = new Quality(player, qualities, defaultQualityLevel);\n\n  player.trigger('quality', qualities);\n};\n\nvideojs.registerPlugin('setQualities', setQualities);\n\nvideojs.hook('setup', vjsPlayer => {\n  const { qualities } = vjsPlayer.options_;\n\n  if (qualities && qualities.length) {\n    const defaultQualityLevel = qualities.findIndex(v => v.default);\n\n    vjsPlayer.setQualities(qualities, defaultQualityLevel);\n  }\n});\n"],"names":["List","array","startIndex","values","slice","index_","loop_","index","value","Math","max","min","length","loop","calc","steps","newIndex","step","current","next","prev","ended","SettingOptionItem","videojs","getComponent","QualitySettingItem","player","options","name","label","icon","entries","options_","quality","addClass","on","_","qualities","map","setEntries","show","select","update","onChange","args","player_","pick","selected","prototype","push","registerComponent","Quality","defaultQualityLevel","skip","cachedCurrentTime","currentTime","one","play","src","sources","trigger","setQualities","registerPlugin","hook","vjsPlayer","findIndex","v"],"mappings":"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"}