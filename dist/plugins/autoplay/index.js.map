{"version":3,"file":"index.js","sources":["../../../source/Utils/Log.js","../../../source/Plugin/Autoplay/Autoplay.js"],"sourcesContent":["import videojs from 'video.js';\n\nlet logType = '';\n\ntry {\n  logType = localStorage && localStorage.getItem('vjs-plus-log');\n} catch (e) {}\n\nconst log = (function () {\n  if (logType === 'normal' || videojs.browser.IE_VERSION) {\n    // log without style\n    return console.info.bind(console, '[VJS Plus]:');\n  } else if (logType) {\n    // log with style\n    return console.info.bind(\n      console,\n      '%c[VJS Plus]:',\n      'font-weight: bold; color:#2196F3;'\n    );\n  }\n\n  return function () {};\n})();\n\nexport default log;\n","import videojs from 'video.js';\nimport log from '../../Utils/Log';\n\nconst AUTOPLAY_SUCCESS = 'autoplay-success';\nconst AUTOPLAY_FAILURE = 'autoplay-failure';\n\nconst AutoplayHandler = player => {\n  const NotPreoload = player.preload() === 'none';\n\n  if (!player.autoplay() || NotPreoload) {\n    player.mutedautoplay_ = 'ignore';\n\n    if (NotPreoload) {\n      log('Preload is none so that manual autoplay start is disabled');\n      player.trigger(AUTOPLAY_FAILURE);\n    }\n\n    return false;\n  }\n\n  const pause = player.pause;\n\n  player.pause = () => {};\n\n  const callback = () => {\n    player.pause = pause;\n\n    player.mutedautoplay_ = true;\n  };\n\n  const resolved = () => {\n    log('Muted Autoplay - Promise Resolved');\n\n    player.trigger(AUTOPLAY_SUCCESS);\n\n    callback();\n  };\n\n  const rejected = error => {\n    log('Muted Autoplay - Promise Rejected', error);\n\n    player.muted(true);\n\n    const handlePlay = player.play();\n\n    if (handlePlay) {\n      handlePlay.then(resolved).catch(err => {\n        log('Seems autoplay is not allowed even player is muted', err);\n        player.trigger(AUTOPLAY_FAILURE);\n        player.hasStarted(false);\n        callback();\n      });\n    } else {\n      log('Second Play Promise is undefined');\n      callback();\n    }\n  };\n\n  player.one('loadedmetadata', function handleMutedAutoplay() {\n    // without ready, `player.play()` may retutn `undefined` as `this.changingSrc_` is true\n    player.ready(() => {\n      const playPromise = player.play();\n\n      if (playPromise !== undefined && playPromise !== null) {\n        playPromise.then(resolved).catch(rejected);\n      } else {\n        log('Browser not support play promise');\n\n        setTimeout(callback, 1000);\n      }\n    });\n  });\n};\n\nvideojs.hook('setup', vjsPlayer => {\n  vjsPlayer.one('loadstart', () => {\n    AutoplayHandler(vjsPlayer);\n  });\n});\n"],"names":["logType","localStorage","getItem","e","log","videojs","browser","IE_VERSION","console","info","bind","AUTOPLAY_SUCCESS","AUTOPLAY_FAILURE","AutoplayHandler","player","NotPreoload","preload","autoplay","mutedautoplay_","trigger","pause","callback","resolved","rejected","error","muted","handlePlay","play","then","err","hasStarted","one","handleMutedAutoplay","ready","playPromise","undefined","setTimeout","hook","vjsPlayer"],"mappings":"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"}