{"version":3,"file":"index.js","sources":["../../../source/Plugin/Live/LiveNotice.js","../../../source/Plugin/Live/Live.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\n/**\n * Displays the live indicator when duration is Infinity.\n * \n * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js\n *\n * @extends Component\n */\nclass LiveNotice extends ClickableComponent {\n\n  /**\n   * Creates an instance of this class.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L15-L33\n   *\n   * @param {Player} player\n   *        The `Player` that this class should be attached to.\n   *\n   * @param {Object} [options]\n   *        The key/value store of player options.\n   */\n  constructor(player, options) {\n    super(player, options);\n\n    this.updateLiveEdgeStatus();\n\n    if (this.player_.liveTracker) {\n      this.updateLiveEdgeStatusHandler_ = (e) => this.updateLiveEdgeStatus(e);\n      this.on(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n  }\n\n  /**\n   * Create the `Component`'s DOM element\n   *\n   * @return {Element}\n   *         The element that was created.\n   */\n  createEl() {\n    const el = videojs.dom.createEl('div', {\n      className: 'vjs-live-notice',\n      innerHTML: `\n        <div class=\"vjs-live-notice-spot vjs-icon-circle\"></div>\n        Live\n      `\n    });\n\n    return el;\n  }\n\n  /**\n   * Update the state of this button if we are at the live edge\n   * or not\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L57-L72\n   */\n  updateLiveEdgeStatus() {\n    // default to live edge\n    if (!this.player_.liveTracker || this.player_.liveTracker.atLiveEdge()) {\n      this.setAttribute('aria-disabled', true);\n      this.addClass('vjs-at-live-edge');\n    } else {\n      this.setAttribute('aria-disabled', false);\n      this.removeClass('vjs-at-live-edge');\n    }\n  }\n\n  /**\n   * On click bring us as near to the live point as possible.\n   * This requires that we wait for the next `live-seekable-change`\n   * event which will happen every segment length seconds.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L74-L81\n   */\n  handleClick() {\n    this.player_.liveTracker.seekToLiveEdge();\n  }\n\n  /**\n   * Dispose of the element and stop tracking\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L83-L94\n   */\n  dispose() {\n    if (this.player_.liveTracker) {\n      this.off(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n    this.textEl_ = null;\n\n    super.dispose();\n  }\n}\n\nvideojs.registerComponent('LiveNotice', LiveNotice);\n\nexport default LiveNotice;\n","import videojs from 'video.js';\nimport LiveNotice from './LiveNotice';\nimport './Live.scss';\n\nconst Plugin = videojs.getPlugin('plugin');\n\nconst defaults = {\n  dvr: true\n}\n\nclass Live extends Plugin {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.options = videojs.mergeOptions(defaults, options);\n\n    this.createLiveNotive(player);\n\n    this.start(player);\n  }\n\n  createLiveNotive(player) {\n    const { parent, index } = player.findChild('DurationDisplay')[0];\n    const noticeEl = new LiveNotice(player);\n\n    parent.addChild(noticeEl, {}, index);\n\n    this.on('dispose', () => {\n      parent.removeChild(noticeEl);\n    });\n  }\n\n  start(player) {\n    const onTimeupdate = this.onTimeUpdate.bind(this);\n\n    player.addClass('vjs-live-streaming');\n    if (this.options.dvr) {\n      player.addClass('vjs-live-dvr');\n    }\n    player.on('timeupdate', onTimeupdate);\n\n    this.on('dispose', () => {\n      player.off('timeupdate', onTimeupdate);\n      player.removeClass('vjs-live-streaming');\n      player.removeClass('vjs-live-dvr');\n      player.removeClass('vjs-live');\n    });\n  }\n\n  onTimeUpdate() {\n    const player = this.player;\n    const duration = player.duration();\n\n    if (duration === Infinity || player.currentTime() >= duration) {\n      player.addClass('vjs-live');\n    } else {\n      player.removeClass('vjs-live');\n    }\n  }\n}\n\nvideojs.registerPlugin('live', Live);\n"],"names":["ClickableComponent","videojs","getComponent","LiveNotice","player","options","updateLiveEdgeStatus","player_","liveTracker","updateLiveEdgeStatusHandler_","e","on","createEl","el","dom","className","innerHTML","atLiveEdge","setAttribute","addClass","removeClass","handleClick","seekToLiveEdge","dispose","off","textEl_","registerComponent","Plugin","getPlugin","defaults","dvr","Live","mergeOptions","createLiveNotive","start","findChild","parent","index","noticeEl","addChild","removeChild","onTimeupdate","onTimeUpdate","bind","duration","Infinity","currentTime","registerPlugin"],"mappings":"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"}