{"version":3,"file":"live.es.js","sources":["../../../source/Plugin/Live/LiveNotice.js","../../../source/Plugin/Live/Live.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\n/**\n * Displays the live indicator when duration is Infinity.\n * \n * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js\n *\n * @extends Component\n */\nclass LiveNotice extends ClickableComponent {\n\n  /**\n   * Creates an instance of this class.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L15-L33\n   *\n   * @param {Player} player\n   *        The `Player` that this class should be attached to.\n   *\n   * @param {Object} [options]\n   *        The key/value store of player options.\n   */\n  constructor(player, options) {\n    super(player, options);\n\n    this.updateLiveEdgeStatus();\n\n    if (this.player_.liveTracker) {\n      this.updateLiveEdgeStatusHandler_ = (e) => this.updateLiveEdgeStatus(e);\n      this.on(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n  }\n\n  /**\n   * Create the `Component`'s DOM element\n   *\n   * @return {Element}\n   *         The element that was created.\n   */\n  createEl() {\n    const el = videojs.dom.createEl('div', {\n      className: 'vjs-live-notice',\n      innerHTML: `\n        <div class=\"vjs-live-notice-spot vjs-icon-circle\"></div>\n        Live\n      `\n    });\n\n    return el;\n  }\n\n  /**\n   * Update the state of this button if we are at the live edge\n   * or not\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L57-L72\n   */\n  updateLiveEdgeStatus() {\n    // default to live edge\n    if (!this.player_.liveTracker || this.player_.liveTracker.atLiveEdge()) {\n      this.setAttribute('aria-disabled', true);\n      this.addClass('vjs-at-live-edge');\n    } else {\n      this.setAttribute('aria-disabled', false);\n      this.removeClass('vjs-at-live-edge');\n    }\n  }\n\n  /**\n   * On click bring us as near to the live point as possible.\n   * This requires that we wait for the next `live-seekable-change`\n   * event which will happen every segment length seconds.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L74-L81\n   */\n  handleClick() {\n    this.player_.liveTracker.seekToLiveEdge();\n  }\n\n  /**\n   * Dispose of the element and stop tracking\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L83-L94\n   */\n  dispose() {\n    if (this.player_.liveTracker) {\n      this.off(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n    this.textEl_ = null;\n\n    super.dispose();\n  }\n}\n\nvideojs.registerComponent('LiveNotice', LiveNotice);\n\nexport default LiveNotice;\n","import videojs from 'video.js';\nimport LiveNotice from './LiveNotice';\nimport './Live.scss';\n\nconst Plugin = videojs.getPlugin('plugin');\n\nconst defaults = {\n  dvr: true\n}\n\nclass Live extends Plugin {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.options = videojs.mergeOptions(defaults, options);\n\n    this.createLiveNotive(player);\n\n    this.start(player);\n  }\n\n  createLiveNotive(player) {\n    const { parent, index } = player.findChild('DurationDisplay')[0];\n    const noticeEl = new LiveNotice(player);\n\n    parent.addChild(noticeEl, {}, index);\n\n    this.on('dispose', () => {\n      parent.removeChild(noticeEl);\n    });\n  }\n\n  start(player) {\n    const onTimeupdate = this.onTimeUpdate.bind(this);\n\n    player.addClass('vjs-live-streaming');\n    if (this.options.dvr) {\n      player.addClass('vjs-live-dvr');\n    }\n    player.on('timeupdate', onTimeupdate);\n\n    this.on('dispose', () => {\n      player.off('timeupdate', onTimeupdate);\n      player.removeClass('vjs-live-streaming');\n      player.removeClass('vjs-live-dvr');\n      player.removeClass('vjs-live');\n    });\n  }\n\n  onTimeUpdate() {\n    const player = this.player;\n    const duration = player.duration();\n\n    if (duration === Infinity || player.currentTime() >= duration) {\n      player.addClass('vjs-live');\n    } else {\n      player.removeClass('vjs-live');\n    }\n  }\n}\n\nvideojs.registerPlugin('live', Live);\n"],"names":["ClickableComponent","videojs","getComponent","LiveNotice","player","options","updateLiveEdgeStatus","player_","liveTracker","updateLiveEdgeStatusHandler_","e","on","createEl","el","dom","className","innerHTML","atLiveEdge","setAttribute","addClass","removeClass","handleClick","seekToLiveEdge","dispose","off","textEl_","registerComponent","Plugin","getPlugin","defaults","dvr","Live","mergeOptions","createLiveNotive","start","findChild","parent","index","noticeEl","addChild","removeChild","onTimeupdate","onTimeUpdate","bind","duration","Infinity","currentTime","registerPlugin"],"mappings":"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"}