{"version":3,"file":"index.js","sources":["../../../source/Utils/Log.js","../../../source/Plugin/QualityHls/QualityHlsSettingItem.js"],"sourcesContent":["import videojs from 'video.js';\n\nlet logType = '';\n\ntry {\n  logType = localStorage && localStorage.getItem('vjs-plus-log');\n} catch (e) {}\n\nconst log = (function () {\n  if (logType === 'normal' || videojs.browser.IE_VERSION) {\n    // log without style\n    return console.info.bind(console, '[VJS Plus]:');\n  } else if (logType) {\n    // log with style\n    return console.info.bind(\n      console,\n      '%c[VJS Plus]:',\n      'font-weight: bold; color:#2196F3;'\n    );\n  }\n\n  return function () {};\n})();\n\nexport default log;\n","import videojs from 'video.js';\nimport log from '../../Utils/Log';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass QualityHlsSettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'QualityHlsSettingItem',\n      label: 'Quality',\n      icon: 'vjs-icon-hd'\n    });\n\n    this.addClass('vjs-setting-quality');\n\n    this.levels = [];\n\n    this.handleAllLevelsAdded();\n  }\n\n  handleAllLevelsAdded() {\n    const player = this.player_;\n\n    if (!player.qualityLevels) {\n      log('plugin videojs-contrib-quality-levels do not exsits');\n\n      return false;\n    }\n\n    const qualityLevels = player.qualityLevels();\n    let levels = [];\n    let timeout;\n\n    qualityLevels.on('addqualitylevel', ({ qualityLevel }) => {\n      clearTimeout(timeout);\n\n      levels.push(qualityLevel);\n\n      const callback = () => {\n        this.levels = levels.slice(0);\n\n        player.trigger('before-quality-setup', {\n          levels: this.levels\n        });\n\n        this.onAllLevelsAdded();\n\n        levels = [];\n      };\n\n      timeout = setTimeout(callback, 10);\n    });\n  }\n\n  onAllLevelsAdded() {\n    const entries = [\n      ...this.levels\n        .map(({ height, width }) => {\n          const quality = (width < height) ? width : height;\n\n          return {\n            label: this.localize(`${quality}p`),\n            value: height,\n            default: false\n          };\n        })\n        .sort((a, b) => {\n          return b.value - a.value;\n        }),\n      {\n        label: 'Auto',\n        value: 'auto',\n        default: true\n      }\n    ];\n\n    if (this.levels.length > 1) {\n      // use auto as default\n      this.setEntries(entries, entries.length - 1);\n\n      this.show();\n\n      this.player_.trigger('hls-quality', this.levels);\n    } else {\n      this.hide();\n    }\n  }\n\n  onChange(...args) {\n    super.onChange(...args);\n\n    const { value } = this.selected;\n\n    this.levels.forEach(lv => {\n      lv.enabled = lv.height === value || value === 'auto';\n    });\n\n    this.player_.trigger(\n      'hls-qualitychange',\n      this.entries.reduce((acc, entry, index) => {\n        if (entry.value === value) {\n          const level = this.levels.find(v => v.height === value) || {};\n\n          acc = {\n            index,\n            level,\n            ...entry\n          };\n        }\n\n        return acc;\n      }, {})\n    );\n  }\n}\n\nvideojs\n  .getComponent('SettingMenuButton')\n  .prototype.options_.entries.push('QualityHlsSettingItem');\n\nvideojs.registerComponent('QualityHlsSettingItem', QualityHlsSettingItem);\n\nexport default QualityHlsSettingItem;\n"],"names":["logType","localStorage","getItem","e","log","videojs","browser","IE_VERSION","console","info","bind","SettingOptionItem","getComponent","QualityHlsSettingItem","player","options","name","label","icon","addClass","levels","handleAllLevelsAdded","player_","qualityLevels","timeout","on","qualityLevel","clearTimeout","push","callback","slice","trigger","onAllLevelsAdded","setTimeout","entries","map","height","width","quality","localize","value","sort","a","b","length","setEntries","show","hide","onChange","args","selected","forEach","lv","enabled","reduce","acc","entry","index","level","find","v","prototype","options_","registerComponent"],"mappings":"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"}