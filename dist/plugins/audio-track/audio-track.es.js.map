{"version":3,"file":"audio-track.es.js","sources":["../../../source/Plugin/AudioTrack/AudioTrackSettingItem.js","../../../source/Plugin/AudioTrack/AudioTrack.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst SettingOptionItem = videojs.getComponent('SettingOptionItem');\n\nclass AudioTrackSettingItem extends SettingOptionItem {\n  constructor(player, options) {\n    super(player, {\n      ...options,\n      name: 'AudioTrackSettingItem',\n      label: 'Audio',\n      icon: 'vjs-icon-audiotrack'\n    });\n\n    this.addClass('vjs-setting-audio');\n\n    let timeout;\n    const onHlsUsageEvent = evt => {\n      if (evt.name === 'hls-audio-change') {\n        clearTimeout(timeout);\n\n        timeout = setTimeout(this.handleAudioChangeEvent.bind(this), 10);\n      } else if (evt.name === 'hls-alternate-audio') {\n        this.onAlternateAudio();\n      }\n    };\n\n    player.ready(() => {\n      // show when alternate audio detected\n      player.tech_.on('usage', onHlsUsageEvent);\n    });\n\n    // unbind the callback on player dispose\n    player.on('dispose', () => {\n      player.tech_.off('usage', onHlsUsageEvent);\n    });\n\n    player.on('audiochange', (_, { index }) => {\n      this.select(index);\n      this.update(index);\n    });\n\n    // hide when new source set\n    player.on('loadstart', () => {\n      this.hide();\n    });\n  }\n\n  onChange(...args) {\n    super.onChange(...args);\n    this.player_.audio().pick(this.selected.value);\n  }\n\n  onAlternateAudio() {\n    const audioTracks = this.player_.audio().values();\n\n    const audioEntries = audioTracks.map((track, index) => {\n      const { id, kind, label, language } = track;\n\n      // label and value are necessary attributes\n      return {\n        label: this.localize(label),\n        value: index,\n        id,\n        kind,\n        language,\n        index,\n        track\n      };\n    });\n\n    this.player_.trigger('before-audio-setup', audioEntries);\n\n    this.setEntries(audioEntries);\n\n    this.show();\n\n    this.player_.trigger('audio', audioEntries);\n  }\n\n  handleAudioChangeEvent() {\n    const audioTracks = this.player_.audio().values();\n    const currentEntry = audioTracks.reduce((acc, track, index) => {\n      if (track.enabled) {\n        acc = this.entries[index];\n      }\n\n      return acc;\n    }, {});\n\n    this.player_.trigger('audiochange', currentEntry);\n  }\n}\n\nvideojs\n  .getComponent('SettingMenuButton')\n  .prototype.options_.entries.push('AudioTrackSettingItem');\n\nvideojs.registerComponent('AudioTrackSettingItem', AudioTrackSettingItem);\n\nexport default AudioTrackSettingItem;\n","import videojs from 'video.js';\nimport './AudioTrackSettingItem';\n\nclass audio extends videojs.getPlugin('plugin') {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.track = this.values().find(track => track.enabled);\n\n    // I am worried about audio changed by other factor\n    // So also listen on `audiochange` and update the value\n    player.on('audiochange', (_, { index }) => {\n      this.track = this.values()[index];\n    });\n  }\n\n  values() {\n    const tracks = this.player.audioTracks();\n    const result = [];\n\n    for (let i = 0; i < tracks.length; i++) {\n      result.push(tracks[i]);\n    }\n\n    return result;\n  }\n\n  pick(index) {\n    const values = this.values();\n    const newAudio = values[index];\n\n    if (newAudio) {\n      this.track.enabled = false;\n      this.track = newAudio;\n\n      newAudio.enabled = true;\n    }\n  }\n}\n\nvideojs.registerPlugin('audio', audio);\n"],"names":["SettingOptionItem","videojs","getComponent","AudioTrackSettingItem","player","options","name","label","icon","addClass","timeout","onHlsUsageEvent","evt","clearTimeout","setTimeout","handleAudioChangeEvent","bind","onAlternateAudio","ready","tech_","on","off","_","index","select","update","hide","onChange","args","player_","audio","pick","selected","value","audioTracks","values","audioEntries","map","track","id","kind","language","localize","trigger","setEntries","show","currentEntry","reduce","acc","enabled","entries","prototype","options_","push","registerComponent","find","tracks","result","i","length","newAudio","getPlugin","registerPlugin"],"mappings":"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"}