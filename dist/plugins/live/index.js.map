{"version":3,"file":"index.js","sources":["../../../source/Plugin/Live/LiveNotice.js","../../../source/Plugin/Live/Live.js"],"sourcesContent":["import videojs from 'video.js';\n\nconst ClickableComponent = videojs.getComponent('ClickableComponent');\n\n/**\n * Displays the live indicator when duration is Infinity.\n * \n * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js\n *\n * @extends Component\n */\nclass LiveNotice extends ClickableComponent {\n\n  /**\n   * Creates an instance of this class.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L15-L33\n   *\n   * @param {Player} player\n   *        The `Player` that this class should be attached to.\n   *\n   * @param {Object} [options]\n   *        The key/value store of player options.\n   */\n  constructor(player, options) {\n    super(player, options);\n\n    this.updateLiveEdgeStatus();\n\n    if (this.player_.liveTracker) {\n      this.updateLiveEdgeStatusHandler_ = (e) => this.updateLiveEdgeStatus(e);\n      this.on(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n  }\n\n  /**\n   * Create the `Component`'s DOM element\n   *\n   * @return {Element}\n   *         The element that was created.\n   */\n  createEl() {\n    const el = videojs.dom.createEl('div', {\n      className: 'vjs-live-notice',\n      innerHTML: `\n        <div class=\"vjs-live-notice-spot vjs-icon-circle\"></div>\n        Live\n      `\n    });\n\n    return el;\n  }\n\n  /**\n   * Update the state of this button if we are at the live edge\n   * or not\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L57-L72\n   */\n  updateLiveEdgeStatus() {\n    // default to live edge\n    if (!this.player_.liveTracker || this.player_.liveTracker.atLiveEdge()) {\n      this.setAttribute('aria-disabled', true);\n      this.addClass('vjs-at-live-edge');\n    } else {\n      this.setAttribute('aria-disabled', false);\n      this.removeClass('vjs-at-live-edge');\n    }\n  }\n\n  /**\n   * On click bring us as near to the live point as possible.\n   * This requires that we wait for the next `live-seekable-change`\n   * event which will happen every segment length seconds.\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L74-L81\n   */\n  handleClick() {\n    this.player_.liveTracker.seekToLiveEdge();\n  }\n\n  /**\n   * Dispose of the element and stop tracking\n   * \n   * https://github.com/videojs/video.js/blob/eb8f802391392406ad9801a76934aa7a98dd1bdb/src/js/control-bar/seek-to-live.js#L83-L94\n   */\n  dispose() {\n    if (this.player_.liveTracker) {\n      this.off(this.player_.liveTracker, 'liveedgechange', this.updateLiveEdgeStatusHandler_);\n    }\n    this.textEl_ = null;\n\n    super.dispose();\n  }\n}\n\nvideojs.registerComponent('LiveNotice', LiveNotice);\n\nexport default LiveNotice;\n","import videojs from 'video.js';\nimport LiveNotice from './LiveNotice';\nimport './Live.scss';\n\nconst Plugin = videojs.getPlugin('plugin');\n\nconst defaults = {\n  dvr: true\n}\n\nclass Live extends Plugin {\n  constructor(player, options = {}) {\n    super(player, options);\n\n    this.options = videojs.mergeOptions(defaults, options);\n\n    this.createLiveNotive(player);\n\n    this.start(player);\n  }\n\n  createLiveNotive(player) {\n    const { parent, index } = player.findChild('DurationDisplay')[0];\n    const noticeEl = new LiveNotice(player);\n\n    parent.addChild(noticeEl, {}, index);\n\n    this.on('dispose', () => {\n      parent.removeChild(noticeEl);\n    });\n  }\n\n  start(player) {\n    const onTimeupdate = this.onTimeUpdate.bind(this);\n\n    player.addClass('vjs-live-streaming');\n    if (this.options.dvr) {\n      player.addClass('vjs-live-dvr');\n    }\n    player.on('timeupdate', onTimeupdate);\n\n    this.on('dispose', () => {\n      player.off('timeupdate', onTimeupdate);\n      player.removeClass('vjs-live-streaming');\n      player.removeClass('vjs-live-dvr');\n      player.removeClass('vjs-live');\n    });\n  }\n\n  onTimeUpdate() {\n    const player = this.player;\n    const duration = player.duration();\n\n    if (duration === Infinity || player.currentTime() >= duration) {\n      player.addClass('vjs-live');\n    } else {\n      player.removeClass('vjs-live');\n    }\n  }\n}\n\nvideojs.registerPlugin('live', Live);\n"],"names":["ClickableComponent","videojs","getComponent","LiveNotice","player","options","updateLiveEdgeStatus","player_","liveTracker","updateLiveEdgeStatusHandler_","e","on","createEl","el","dom","className","innerHTML","atLiveEdge","setAttribute","addClass","removeClass","handleClick","seekToLiveEdge","dispose","off","textEl_","registerComponent","Plugin","getPlugin","defaults","dvr","Live","mergeOptions","createLiveNotive","start","findChild","parent","index","noticeEl","addChild","removeChild","onTimeupdate","onTimeUpdate","bind","duration","Infinity","currentTime","registerPlugin"],"mappings":"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"}